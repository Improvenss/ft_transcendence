# LINK: https://docs.docker.com/compose/compose-file/compose-versioning/
version: '3.9'

###############################################################################
#                             NETWORKS                                        #
#/////////////////////////////////////////////////////////////////////////////#

networks:
  transcendence_network:
    name: t_network
    driver: bridge

###############################################################################
#                             VOLUMES                                         #
#/////////////////////////////////////////////////////////////////////////////#

volumes:
  postgres_data:
    driver: local
    driver_opts:
      type: none
      o: bind
      device: ./data/postgres
  pgadmin4_data:
    driver: local
    driver_opts:
      type: none
      o: bind
      device: ./data/pgadmin4
  # redis_data:
  #   driver: local
  #   driver_opts:
  #     type: none
  #     o: bind
  #     device: ./data/redis
  # backend_data:
  #   driver: local
  #   driver_opts:
  #     type: none
  #     o: bind
  #     device: ./data/backend
  # frontend_data:
  #   driver: local
  #   driver_opts:
  #     type: none
  #     o: bind
  #     device: ./data/frontend

###############################################################################
#                             SERVICES                                        #
#/////////////////////////////////////////////////////////////////////////////#
services:
  # ___PostgreSQL___ # OK
  postgres:
    container_name: postgres
    image: postgres:16.0-alpine3.18
    env_file:
      - ./srcs/requirements/postgres/.env
    environment:
      TZ: "Europe/Istanbul"
    volumes:
      - postgres_data:/var/lib/postgresql/data
      - ./srcs/requirements/postgres/create-database.sh:/docker-entrypoint-initdb.d/create-database.sh # PostgreSQL bu 'docker-entypoing-initdb.d' klasorunun icerisindekileri container olusup postgresql calistirildiktan sonra otomatik bir sekilde bu icerisindeki dosyalari calistiriyor.
    networks:
      - transcendence_network
    restart: unless-stopped # Durdurulmadigi surece.
    ports:
      - 5432:5432 # Local port / Exported port. postgres's default port(5432).
  # ________________ #
  # ____pgadmin4____ # OK
  pgadmin4:
    container_name: pgadmin4
    image: dpage/pgadmin4:7.7
    env_file:
      - ./srcs/requirements/pgadmin4/.env
    environment:
      TZ: "Europe/Istanbul"
    volumes:
      - ./srcs/requirements/pgadmin4/servers.json:/pgadmin4/servers.json
      - pgadmin4_data:/pgadmin4
    networks:
      - transcendence_network
    restart: unless-stopped
    ports:
      - 5050:80 # Local port / Exported port.
    depends_on:
      - postgres
  # ________________ #
  # # ___redis_cache__ #
  # redis:
  #   image: redis:7.2.1-alpine3.18
  #   # env_file:
  #   #   - ./srcs/envFiles/redis.env
  #   volumes:
  #     - ./srcs/requirements/redis:/app
  #   networks:
  #     # - bridge
  #     - transcendence_network
  #   restart: unless-stopped
  #   ports:
  #     - 6379:6379 # Local port / Exported port.
  #   depends_on:
  #     - ssl
  #     - postgres #   # progress: plain
  # # ________________ #
  # _____backend____ #
  backend: # Backend's container.
    container_name: backend
    build: ./srcs/requirements/backend/ # Container's 'Dockerfile' path location for run this file.
    # env_file:
    #   - ./srcs/envFiles/backend.env
    volumes:
      - ./srcs/requirements/backend:/app
    networks:
      - transcendence_network
    restart: unless-stopped
    ports:
      - 3000:3000 # Local port / Exported port. nestjs's default port(3000).
    depends_on:
      - postgres
    # progress: plain
  # ________________ #
  # ____frontend____ #
  frontend: # Frontend's container.
    container_name: frontend
    build: ./srcs/requirements/frontend/ # Container's 'Dockerfile' path location for run this file.
    # env_file:
    #   - ./srcs/envFiles/frontend.env
    volumes:
      - ./srcs/requirements/frontend:/app
    networks:
      - transcendence_network
    restart: unless-stopped
    ports:
      # - 80:80 # Local port / Exported port.
      - 443:443
    depends_on:
      - postgres
      - backend
    # progress: plain
  # ________________ #